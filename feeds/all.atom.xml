<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Monty's Blog</title><link href="beardedplatypus.github.io/" rel="alternate"></link><link href="beardedplatypus.github.io/feeds/all.atom.xml" rel="self"></link><id>beardedplatypus.github.io/</id><updated>2018-03-08T00:00:00+01:00</updated><entry><title>Creating a sticky header with elm(-ish)</title><link href="beardedplatypus.github.io/creating-a-sticky-header-with-elm-ish.html" rel="alternate"></link><published>2018-03-08T00:00:00+01:00</published><updated>2018-03-08T00:00:00+01:00</updated><author><name>Maarten Tegelaers</name></author><id>tag:None,2018-03-08:beardedplatypus.github.io/creating-a-sticky-header-with-elm-ish.html</id><summary type="html">&lt;p&gt;I have added a simple sticky header to this blog (at the time of writing). I 
figured I would write a little article about the design and code, both as a 
personal reminder and to hopefully help people like you. This sticky header is
written in elm(-ish). For those …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I have added a simple sticky header to this blog (at the time of writing). I 
figured I would write a little article about the design and code, both as a 
personal reminder and to hopefully help people like you. This sticky header is
written in elm(-ish). For those that do not know &lt;a href="http://elm-lang.org"&gt;elm&lt;/a&gt;, it
is basically a functional programming languages which compiles into Javascript.
It allows one to build interactive web applications without run-time errors.
Ever since I had to use it for an university project, I have loved this little
language.&lt;/p&gt;
&lt;p&gt;Using elm for such a small element of my blog is probably overkill, and a couple
of lines of simple Javascript could have sufficed as well. However, me being me, 
I opted for the more convoluted approach. The main reason to use elm, is to 
explore how well it would play together with 
&lt;a href="https://blog.getpelican.com"&gt;Pelican&lt;/a&gt;, the static site generator I use for this
blog. Furthermore, since it is such a small feature of the site, it was a good 
simple exercise to keep my elm skills a bit fresh. So without further ado, let's
take a look at the header.&lt;/p&gt;
&lt;h1&gt;Layout&lt;/h1&gt;
&lt;p&gt;The header I had envisioned is quite simple. The top part would be contain 
some branding in the form of "Monthy's Blog" in big letters. Underneath that
the navbar containing links to the blog, about-me and portfolio pages.
The navbar should turn sticky once we scrolled past the branding. &lt;/p&gt;
&lt;p&gt;This leads to the following layout hierarchy: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;div: banner&lt;ul&gt;
&lt;li&gt;div: navbar&lt;ul&gt;
&lt;li&gt;div: brand&lt;/li&gt;
&lt;li&gt;div: navigation elements&lt;ul&gt;
&lt;li&gt;link: blog&lt;/li&gt;
&lt;li&gt;link: about me&lt;/li&gt;
&lt;li&gt;link: portfolio&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;with the layout planned, we can move to implementing the header in elm.&lt;/p&gt;
&lt;h1&gt;Code and Pelican Interop&lt;/h1&gt;
&lt;p&gt;We divide the code into two parts, first I'll go over all the elm code needed
to get the header working. Then we will look at the html/javascript side.&lt;/p&gt;
&lt;h2&gt;Elm&lt;/h2&gt;
&lt;p&gt;Web apps, no matter the size, generally use the same typical architecture.
This architecture is explained in depth in the main elm tutorial, which can be
found &lt;a href="https://guide.elm-lang.org/architecture/"&gt;here&lt;/a&gt;. The basic structure 
consists of three components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Model: holds the state of the application&lt;/li&gt;
&lt;li&gt;Msg / Update: provides the method of updating your Model based upon messages
                that the app can send.&lt;/li&gt;
&lt;li&gt;View: describes how the model is displayed and how messages are generated 
        based upon user-input.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Model&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;NavElement&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;nav_elements&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;List&lt;/span&gt; &lt;span class="kt"&gt;NavElement&lt;/span&gt;
                   &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt;
                   &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;is_fixed&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Bool&lt;/span&gt;
                   &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;List&lt;/span&gt; &lt;span class="kt"&gt;NavElement&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt;
&lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nv"&gt;nav_elements&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;nav_elements&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;nav_elements&lt;/span&gt;
                                  &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt;        &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;title&lt;/span&gt;
                                  &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;is_fixed&lt;/span&gt;     &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;False&lt;/span&gt;
                                  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The model consists of three elements. &lt;code&gt;nav_elements&lt;/code&gt; describes the navigation
elements, these consist of a name of the page, i.e. blog, and the url to the
specific website page. The &lt;code&gt;title&lt;/code&gt; describes the title which is placed in the 
branding section of the header. Finally, &lt;code&gt;is_fixed&lt;/code&gt; describes whether the 
navigational elements should be fixed or not. &lt;/p&gt;
&lt;h3&gt;Update / Msg&lt;/h3&gt;
&lt;p&gt;The only change that can currently happen within the header, is the switch 
from non-fixed navigational elements to fixed navigational elements, and 
vice-versa. This is modelled in the &lt;code&gt;is_fixed&lt;/code&gt; element of the Model, and 
updated in the &lt;code&gt;update&lt;/code&gt; function. The amount scrolled by the user can be
modelled as a float value. Each time the user scrolls up or down, the app
receives a new float value describing the new situation. As such we need
to define a single message containing this new float:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;UpdateScrollPos&lt;/span&gt; &lt;span class="kt"&gt;Float&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Whenever the user scrolls, this value is passed to the update which function
which determines if the &lt;code&gt;is_fixed&lt;/code&gt; attribute should be updated.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;Cmd&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
  &lt;span class="kr"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="kr"&gt;of&lt;/span&gt;
    &lt;span class="kt"&gt;UpdateScrollPos&lt;/span&gt; &lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;is_fixed&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;x&lt;/span&gt; &lt;span class="nf"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mf"&gt;81.&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;Cmd&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;none&lt;/span&gt;
      &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We set &lt;code&gt;is_fixed&lt;/code&gt; to true, whenever we scroll past 81.3, and to false, when this
is not the case. The value 81.3 is equal to the size of the branding. Of course
it would be significantly more elegant if we could determine this value in code,
instead of hard coding it. However, I have not found this option in elm at the 
current moment. Thus, this has to suffice for now.&lt;/p&gt;
&lt;h3&gt;View&lt;/h3&gt;
&lt;p&gt;Now that we have defined the model, and how to update, it is time to implement 
the determined layout in elm: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;viewNavElement&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;NavElement&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;viewNavElement&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;txt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
  &lt;span class="nv"&gt;li&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
     &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="nv"&gt;url&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
         &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="nv"&gt;txt&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
     &lt;span class="p"&gt;]&lt;/span&gt;


&lt;span class="nv"&gt;viewNavElements&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;List&lt;/span&gt; &lt;span class="kt"&gt;NavElement&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Bool&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;viewNavElements&lt;/span&gt; &lt;span class="nv"&gt;nav_elements&lt;/span&gt; &lt;span class="nv"&gt;is_fixed&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
  &lt;span class="kr"&gt;let&lt;/span&gt;
    &lt;span class="nv"&gt;att&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;nav&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;navbar-nav&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;banner-background&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;banner-background-bottom&amp;quot;&lt;/span&gt;
          &lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="kr"&gt;in&lt;/span&gt;
    &lt;span class="nv"&gt;ul&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;is_fixed&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;sticky&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nf"&gt;::&lt;/span&gt; &lt;span class="nv"&gt;att&lt;/span&gt; &lt;span class="kr"&gt;else&lt;/span&gt; &lt;span class="nv"&gt;att&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="kt"&gt;List&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;map&lt;/span&gt; &lt;span class="nv"&gt;viewNavElement&lt;/span&gt; &lt;span class="nv"&gt;nav_elements&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
  &lt;span class="kr"&gt;let&lt;/span&gt;
    &lt;span class="nv"&gt;brand&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;div&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;is_fixed&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;navbar-brand&amp;quot;&lt;/span&gt;
                    &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;banner-background&amp;quot;&lt;/span&gt;
                    &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;fixed-padding&amp;quot;&lt;/span&gt;
                    &lt;span class="p"&gt;]&lt;/span&gt;
                  &lt;span class="kr"&gt;else&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;navbar-brand&amp;quot;&lt;/span&gt;
                    &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;banner-background&amp;quot;&lt;/span&gt;
                    &lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;title&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="nv"&gt;navbar&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;viewNavElements&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;nav_elements&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;is_fixed&lt;/span&gt;

  &lt;span class="kr"&gt;in&lt;/span&gt;
    &lt;span class="nv"&gt;div&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;id&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;banner&amp;quot;&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;nav&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;id&lt;/span&gt;    &lt;span class="s"&gt;&amp;quot;site-navigation&amp;quot;&lt;/span&gt;
              &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;navbar&amp;quot;&lt;/span&gt;
              &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;attribute&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;role&amp;quot;&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;navigation&amp;quot;&lt;/span&gt;
              &lt;span class="p"&gt;]&lt;/span&gt;
              &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;brand&lt;/span&gt;
              &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;navbar&lt;/span&gt;
              &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This function describes both the fixed and non-fixed situations, by adding
additional classes to the elements when the header should be fixed. If the 
header is fixed, then the brand should extend to the size of the navigational
elements as well. This way, the content does not jump upward, due to the height
of the navigational elements being removed from the header. This is done by
adding the &lt;code&gt;fixed_padding&lt;/code&gt; class to the brand. The bar containing the nav
elements is made sticky by adding the &lt;code&gt;sticky class&lt;/code&gt; to the &lt;code&gt;ul&lt;/code&gt; class.
The layout of the elements is equal to the layout described earlier.&lt;/p&gt;
&lt;h2&gt;Html / Javascript&lt;/h2&gt;
&lt;p&gt;In order to get the header to fully work, two more problems need to be dealt 
with:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Initialisation of the pages and title.&lt;/li&gt;
&lt;li&gt;Updates of the scroll position.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Initialisation of the elm app&lt;/h3&gt;
&lt;p&gt;In theory, we could hard code the names and pages in the elm code. However,
this would mean, each time we want to make a small change to the name of the
site, or add / remove pages from the navbar, we would need to edit the elm code
again. Hardly a preferable situation. It would be a lot nicer if this data is 
set in the html code which is generated by Pelican. Fortunate for us, this is 
possible by using a mechanism called &lt;a href="https://guide.elm-lang.org/interop/javascript.html"&gt;flags&lt;/a&gt;.
Basically, we define a set of values to be used in elm, which are provided in
the html file in which the elm app is embedded:&lt;/p&gt;
&lt;p&gt;First we define a &lt;code&gt;Flags&lt;/code&gt; record, describing the elements which will be passed
to the elm app:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;Flags&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;brand&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt;
                   &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;pages&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;List&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                   &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then we use these flags to create an init function, which will be used by the
&lt;code&gt;Html.programWithFlags&lt;/code&gt; to create our app:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;init&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Flags&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;Cmd&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;init&lt;/span&gt; &lt;span class="nv"&gt;flags&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nv"&gt;flags&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;pages&lt;/span&gt; &lt;span class="nv"&gt;flags&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;brand&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;Cmd&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;none&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then finally we can add the appropriate values in the html code:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;node&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;header&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Elm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Header&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;embed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;node&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;brand&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Monthy&amp;#39;s Blog&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;pages&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Blog&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{{ SITEURL  }}/index.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
           &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nx"&gt;p&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="nx"&gt;pages&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
           &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{ p.title }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{{ SITEURL }}/{{ p.url }}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
           &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="nx"&gt;endfor&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
           &lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Here we see how pelican and elm can play nicely together. The elm app receives
the Flags field as a dictionary parameter. The flags entries contain the values
as they are defined in the elm file, in our case this is brand and pages. 
The pages value is set as a pelican template command, which upon generation will
add all the pages as values in our final generated html code. Success!&lt;/p&gt;
&lt;h3&gt;Scroll Updates&lt;/h3&gt;
&lt;p&gt;Earlier, we mentioned that we receive scroll updates in the form of floats, 
however, I did not specify where these updates came from. Unfortunately, I 
haven't found a way to subscribe to scroll updates directly in elm, so we 
will have to parse them from javascript. This is possible through the use
of ports, which allows javascript to communicate with our elm app. &lt;/p&gt;
&lt;p&gt;In order to use ports we need to define our module as a ports module by adding
the ports keyword in front of module.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;port&lt;/span&gt; &lt;span class="kr"&gt;module&lt;/span&gt; &lt;span class="kt"&gt;Header&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="nf"&gt;..&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Afterwards we can define our port that will receive the javascript updates:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;port&lt;/span&gt; &lt;span class="nv"&gt;onScroll&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;Float&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Sub&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt;

&lt;span class="nv"&gt;subscriptions&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Sub&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;subscriptions&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;onScroll&lt;/span&gt; &lt;span class="kt"&gt;UpdateScrollPos&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;This port is combined in the subscriptions used by our application. Every time
we receive a float on this port, it is turned into an &lt;code&gt;UpdateScrollPos&lt;/code&gt; message,
which will be run through our &lt;code&gt;update&lt;/code&gt; function.&lt;/p&gt;
&lt;p&gt;Now that we have defined how to deal with updates on the elm side, let's 
generate them at the javascript side:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onscroll&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;updateScroll&lt;/span&gt;&lt;span class="p"&gt;()};&lt;/span&gt;

  &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;updateScroll&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onScroll&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;pageYOffset&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;We register a callback on &lt;code&gt;window.onscroll&lt;/code&gt;. This means that whenever the user
scrolls, our callback is executed. In our case, this executes the 
&lt;code&gt;updateScroll()&lt;/code&gt; function, which sends the &lt;code&gt;window.pageYOffset&lt;/code&gt; to our header.
And with that, we now generate updates whenever the user scrolls on the blog,
allowing elm to determine whether the header should be sticky or not.&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;In this article I have described how I implemented a simple sticky header in 
elm. Overall I would argue that this approach is probably overkill, and a simple
javascript approach would be both simpler and more performant At the same time,
I have shown that elm can work quite nicely with Pelican, thus proving it feasible
to build apps combining both technologies. With that in mind I am happy with the 
results and will continue using this header for the time being! &lt;/p&gt;
&lt;p&gt;There are two aspects, I will most likely work a bit more on. Firstly, I am not
quite satisfied with the transition of non-sticky to sticky, which seems to be 
primarily caused by the size of the brand padding in the sticky situation. I 
will probably tweak the margin / padding a bit more, to ensure it feels smooth.
Secondly, I would like to add a simple gif/animation to the header. This would 
mean I would need to expand my elm code a little bit to make this possible. 
As such, future versions of the header might look a bit differently than the 
one described here. &lt;/p&gt;
&lt;p&gt;The full code for these examples can be found in 
&lt;a href="https://gist.github.com/BeardedPlatypus/f33e41a5af8007a947bbcccef50eea1b"&gt;this gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks for reading, and hopefully see you again!&lt;/p&gt;</content><category term="elm"></category><category term="html"></category></entry><entry><title>Setting up a markdown/LaTeX document.</title><link href="beardedplatypus.github.io/setting-up-a-markdownlatex-document.html" rel="alternate"></link><published>2017-10-05T00:00:00+02:00</published><updated>2017-10-05T00:00:00+02:00</updated><author><name>Maarten Tegelaers</name></author><id>tag:None,2017-10-05:beardedplatypus.github.io/setting-up-a-markdownlatex-document.html</id><summary type="html">&lt;p&gt;In this article we'll take a quick look on how to set up a markdown / LaTeX 
project with the help of Python and Pandoc. The goal is to have a single command
to compile a set of markdown documents into a single LaTeX pdf. As an example 
project I've modified …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In this article we'll take a quick look on how to set up a markdown / LaTeX 
project with the help of Python and Pandoc. The goal is to have a single command
to compile a set of markdown documents into a single LaTeX pdf. As an example 
project I've modified my master thesis paper to consist of markdown files. &lt;/p&gt;
&lt;h1&gt;Motivation&lt;/h1&gt;
&lt;p&gt;LaTeX is a great tool to write beautiful looking documents, however it can be a 
bit ehm... cumbersome, especially the syntax. Markdown on the other hand is a 
wonderfully lightweight markup language that makes writing a joy, at least in my
opinion. Since I had to write a master thesis, I figured I would try and get the
best of both worlds and write my content in markdown, which I would then 
transform into LaTeX documents, which I could compile normally. For those that 
don't know me, I must admit I'm a sucker for convoluted solutions to problems, 
and I can't deny that this played a role into settling on this approach.&lt;/p&gt;
&lt;p&gt;I'm far from the first to explore this approach, there are several blogposts on
the web that, ..., and I have drawn inspiration from those. &lt;/p&gt;
&lt;h1&gt;Tools&lt;/h1&gt;
&lt;p&gt;The main tool, which most blogposts use, is Pandoc. Pandoc is a tool that can
transform text files from a wide variety of syntaxes into different syntaxes. 
On top of that it is free software released under the GPL. The scrooge in me 
can definitely appreciate that. &lt;/p&gt;
&lt;p&gt;After we have transformed the files from markdown to latex, they need to be 
compiled to a pdf, I personally use &lt;code&gt;pdflatex&lt;/code&gt; for that, mostly due to the
fact I'm lazy and haven't looked into other options like XeLaTeX or LuaTeX.
We won't venture too much into the domain of LaTeX itself. I'll assume you
already are familiar with it, if not I definitely recommend taking a look at it.
It is definitely my go to tool for creating documents.&lt;/p&gt;
&lt;p&gt;Lastly we'll use Python to wrap all the different terminal commands into a
single build command. This script will copy the relevant files from the source
folder into a build folder, and then call the appropriate compile functions.
For this we make use of several libraries. All the paths will be done with the
&lt;a href="https://docs.python.org/3/library/pathlib.html"&gt;pathlib library&lt;/a&gt; which comes 
bundled with Python 3. In order to make it possible to run the build function
as a commandline task instead of a script we use &lt;a href="http://www.pyinvoke.org"&gt;Invoke&lt;/a&gt;.
Finally we use &lt;a href="https://plumbum.readthedocs.io/en/latest/"&gt;plumbum&lt;/a&gt; to access
the different executables we need to execute.&lt;/p&gt;
&lt;h1&gt;Document structure&lt;/h1&gt;
&lt;p&gt;Before we dive in to setting up the whole project, lets first take a look at the
document structure. In the case of my paper we can discern three parts: an
abstract, a bunch of section making up the main matter, and the appendix. 
Pandoc makes use of templates to convert files from one type to another. In this
case we will define three templates, an abstract, section and appendix template.
These will generate corresponding LaTeX documents. These LaTeX documents will be
included in a single &lt;code&gt;tex&lt;/code&gt; document which will also specify the document class
and LaTeX packages used. This is done with the &lt;code&gt;\input{&amp;lt;path&amp;gt;}&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;Each of the images used will be written in LaTeX. Images in LaTeX can
be a finicky business. It would most likely be possible to do this neatly in 
markdown as well. However due to my experience with LaTeX, I figured I should
not try and attempt to do these in markdown. Since Pandoc will automatically 
recognise LaTeX commands in markdown, we can freely mix and match LaTeX and
markdown syntax. Each of the images can thus be efficiently included in a 
markdown document with the &lt;code&gt;\input{&amp;lt;path&amp;gt;}&lt;/code&gt; command.&lt;/p&gt;
&lt;p&gt;The references used in the paper will also be done with regular LaTeX commands.
The bibliography file used is a single bibtex file. Within the markdown document
the &lt;code&gt;\cite{&amp;lt;label&amp;gt;}&lt;/code&gt; will be used to cite a source.&lt;/p&gt;
&lt;p&gt;In case of the paper, &lt;a href=""&gt;paper.tex&lt;/a&gt; specifies the LaTeX source file, and 
&lt;a href=""&gt;paper.bib&lt;/a&gt; specifies the bibtex file.&lt;/p&gt;
&lt;h1&gt;Setting up the project&lt;/h1&gt;
&lt;p&gt;With the tools, motivation, and document structure out of the way it's time to
get our hands dirty. I will describe the set up as used within my paper project
however keep in mind that in no need you need to abide by this set up, and the 
code and folder structure could be easily adjusted to fit your personal needs.
We will divide the project into three folders, a &lt;code&gt;src&lt;/code&gt; source
folder, which will contain all the files we write ourselves. a &lt;code&gt;build&lt;/code&gt; folder 
generated by the script we will implement in the next section, and a &lt;code&gt;target&lt;/code&gt;
folder which will also be generated by the script. The compile commands of latex
and markdown will be run on the build folder. The final outputted pdf will be 
copied to the target folder. Under normal circumstances we won't need to dig 
around in the build folder.&lt;/p&gt;
&lt;p&gt;The source folder will contain all of our documents. In the top level we will
have three files: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The &lt;code&gt;tex&lt;/code&gt; document specifying our LaTeX document,&lt;/li&gt;
&lt;li&gt;The bibtex document containing our bibliography&lt;/li&gt;
&lt;li&gt;A &lt;code&gt;conf.json&lt;/code&gt; specifying how our document is structured.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Furthermore we define three folders:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;content&lt;/code&gt;, which contains all of our markdown files&lt;/li&gt;
&lt;li&gt;&lt;code&gt;img&lt;/code&gt;, which will contain all files pertaining to our images&lt;/li&gt;
&lt;li&gt;&lt;code&gt;layout&lt;/code&gt;, which will contain all the relevant pandoc templates&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;content and the conf.json file&lt;/h2&gt;
&lt;p&gt;The content in the paper our structured in a certain way. This structure needs
to be explicitly defined. There are several ways for doing this, I personally
prefer to save this data outside of my documents and use a &lt;a href=""&gt;conf.json file&lt;/a&gt; to
indicate the structure of my document, however alternatives are possible. You
could for example add additional metadata within the filenames and directory names
of the content, and then use some sort of discovery algorithm. That being said, 
it would add additional complexity, which can be circumvented by just using a 
json file to capture the metadata. &lt;/p&gt;
&lt;p&gt;So what's in the json file? Since the json file will be read by the script to
determine the structure of the document will be, basically it contains all
metadata. The top level structure contains the following entries:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;main_tex_file&lt;/code&gt; : Specifies the main LaTeX file, which will be compiled with pdflatex.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;main_bib_file&lt;/code&gt; : Specifies the main bibtex file, which will be compiled with bibtex.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;units&lt;/code&gt; : Specifies the structure of the document.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;units&lt;/code&gt; is a list describing each section within the paper. Personally I like 
to subdivide longer files into smaller self-contained elements. In this case, 
I have divided up my sections into subsections. Each subsection gets its own
markdown file. Thus each unit is structure describing a section of the paper.
Each section gets its own folder within content. The folder name is specified
with the &lt;code&gt;folder&lt;/code&gt; entry. The &lt;code&gt;title&lt;/code&gt; describes the title of the section which
will be used in the template. Finally the subunits describe the subsections
of my paper, in the order they appear in. These are separate markdown files,
which will each be read by the script. These subunits will be combined
during the execution of the script to create a single markdown file per section.&lt;/p&gt;
&lt;p&gt;Finally an &lt;code&gt;abstract.md&lt;/code&gt; and &lt;code&gt;appendix.md&lt;/code&gt; are placed within the content 
folder which will be transformed in there respective LaTeX files.&lt;/p&gt;
&lt;p&gt;The content and conf.json file are closely linked. The conf.json file 
basically describes the structure of the content.&lt;/p&gt;
&lt;h2&gt;layout&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;layout&lt;/code&gt; folder contains the Pandoc templates. 
&lt;a href="http://pandoc.org/MANUAL.html#templates"&gt;A Pandoc template&lt;/a&gt; describes how
the content of a file is translated into the different file. In our case
we need three templates&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=""&gt;abstract&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=""&gt;section&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=""&gt;appendix&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For each of these the template is linked. They are rather small files, which
specify where the body is placed. In the case of the section template, an 
additional parameter is added, the title variable. Here the title of the
section will be placed.&lt;/p&gt;
&lt;h2&gt;img&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;img&lt;/code&gt; folder contains all the files related to the images of the project. 
It contains two subfolders, a &lt;code&gt;tex&lt;/code&gt; folder which contains all the &lt;code&gt;tex&lt;/code&gt; files
typesetting the images which are imported in the markdown/LaTeX files, and 
a &lt;code&gt;raw&lt;/code&gt; folder which contains the actual &lt;code&gt;jpeg&lt;/code&gt;, &lt;code&gt;png&lt;/code&gt;, etc. images. &lt;/p&gt;
&lt;p&gt;This is the basic document structure needed to create markdown/LaTeX pdf files.
Next up, the build script that will do all the heavy lifting!&lt;/p&gt;
&lt;h1&gt;The automatisation script&lt;/h1&gt;
&lt;p&gt;In order to convert the &lt;code&gt;src&lt;/code&gt; folder into a compiled pdf, a bunch of steps need
to be taken. First the separate subunit files need to be combined to make the 
section documents. Then these section documents, the abstract and the appendix
need to be copied to the build folder and converted to &lt;code&gt;tex&lt;/code&gt; documents with pandoc. 
All the image files, the main &lt;code&gt;tex&lt;/code&gt; file and the bibliography files also need 
to be copied to the build file. Then in order to get a nicely formatted pdf, 
first pdflatex needs to be run on the main tex file, then bibtex needs to be run, 
and then pdflatex needs to be run twice more (this has something to due with setting
the citations and references within the text properly, though I don't know the exact
details), only then we can copy the generated pdf to the target folder.&lt;/p&gt;
&lt;p&gt;This, of course, is not something you'd want to have to do each time a small change
is made to the document. So we automate it! For each of these steps we will 
write a small function that automates that exact step. Then all these functions
are called in a single invoke task, which we can call by calling &lt;code&gt;invoke build&lt;/code&gt;
in the root folder of our project.&lt;/p&gt;
&lt;p&gt;We start out with a &lt;a href=""&gt;tasks.py&lt;/a&gt; file. This file has to be called &lt;code&gt;tasks.py&lt;/code&gt; such
that invoke recognises it as a file containing invoke commands. I won't go into
too much depth as much of the script should be rather self-explanatory.&lt;/p&gt;
&lt;h2&gt;Supporting functionality&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;local&lt;/code&gt; is a construct defined in &lt;code&gt;plumbum&lt;/code&gt;. It basically allows us to obtain an
executable which can be found on the &lt;code&gt;path&lt;/code&gt; variable of our terminal, and call 
it, like it is a python function. Pretty sweet stuff. In order for this script
to work, it does require &lt;code&gt;pandoc&lt;/code&gt;, &lt;code&gt;pdflatex&lt;/code&gt;, and &lt;code&gt;bibtex&lt;/code&gt; to be on the path
variable. You can test this easily by calling each of these functions within
the terminal. If it throws an error that the command is not recognises, you
either haven't installed it, or you need to add its directory to the path
variable.&lt;/p&gt;
&lt;p&gt;Pandoc requires a couple of flags, in order to know how the files should be
converted. I wrapped these in three functions, to improve the readability.&lt;/p&gt;
&lt;p&gt;Finally we have three helper functions which are responsible for copying files.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;update_file&lt;/code&gt;: copies the file at the &lt;code&gt;src&lt;/code&gt; to &lt;code&gt;target&lt;/code&gt; if no file at &lt;code&gt;target&lt;/code&gt;
    exists or it is not equal to &lt;code&gt;src&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update_dir&lt;/code&gt;: copies all the files corresponding with the delimiter or set of 
    delimiters, from the &lt;code&gt;src&lt;/code&gt; folder to the &lt;code&gt;target&lt;/code&gt; folder.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;is_str_equal_to_file&lt;/code&gt;: compares the contents of the file and the string on 
    equality. If no file exists it is not equal.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Compile functions&lt;/h2&gt;
&lt;p&gt;Each of the compile functions executes one of the steps defined in the beginning
of this section.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;build_markdown_files&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update_main_tex&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update_main_bib&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update_templates&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update_img&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;compile_markdown&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;compile_latex&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;copy_output&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The update functions merely copy either the specified file or directories, and 
the &lt;code&gt;copy_output&lt;/code&gt; file copies the created pdf to the target.
The more interesting functions are the compile and build functions.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;build_markdown_files&lt;/code&gt; copies the abstract and appendix markdown files 
and then for each section construction a string containing the content of 
that section by appending all the subunits specified in the conf.json file.
In case these have changed since last compilation, they are copied to the
build directory.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;compile_markdown&lt;/code&gt; then compiles each of the markdown files in the &lt;code&gt;md&lt;/code&gt;
subfolder of &lt;code&gt;build&lt;/code&gt;. For this it uses the section template for the sections
and the appendix and abstract for the appendix and abstract files. The output
is saved in &lt;code&gt;build/content&lt;/code&gt;. At the end of the compilation, we have all the 
LaTeX files needed to construct the pdf.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;compile_latex&lt;/code&gt; function calls the 3 pdflatex functions and the bibtex
function in the right order to construct the actual pdf. 
The actual code might is rather straightforward, it specifies the appropriate 
paths and then just calls the executable.&lt;/p&gt;
&lt;h2&gt;Task&lt;/h2&gt;
&lt;p&gt;The last thing left to do is to wrap all of the previous functions into a single
task. This function is called build, and is wrapped inside a &lt;code&gt;@task&lt;/code&gt; decorator.
This will allow invoke to recognise it as a commandline function, which can
then be called with &lt;code&gt;invoke build&lt;/code&gt;. This function reads the configuration file
and then calls all of the previously defined functions. And with that, we can
compile the whole document with just a single command. Whoop whoop.&lt;/p&gt;
&lt;h1&gt;Conclusion and Future work&lt;/h1&gt;
&lt;p&gt;With all of that done, we have shown how to set up a markdown / LaTeX document, which
can be compiled with a single command task. It is a rather straightforward process, 
and can be easily adapted to fit other documents, and it leads to a rather painless
compilation process. &lt;/p&gt;
&lt;p&gt;There are a lot more customisation options which could be included in the script. The
configuration file could be extended with additional elements, like whether elements
should be compiled as sections or chapters. The images should probably be done with
markdown as well. Furthermore the external pandoc executable
should probably be replaced with the appropriate pandoc bindings for the library. 
With each future project involving markdown and LaTeX, I will add a little bit of this 
functionality&lt;/p&gt;
&lt;p&gt;That's it for now, I hope to see you again at the next article!&lt;/p&gt;</content><category term="LaTeX"></category><category term="markdown"></category><category term="python"></category></entry></feed>